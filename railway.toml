# Railway configuration for monorepo backend app
# Located at /backend

[build]
builder = "NIXPACKS"
buildCommand = "cd backend && npm ci && npm run build"
buildDirectory = "backend"

[start]
cmd = "cd backend && npm run start"

# Runs before starting the app (for Prisma migrations)
deployCommand = "cd backend && npx prisma migrate deploy && npx prisma generate && npm run seed"

[deploy]
runtime = "V2"
numReplicas = 1
sleepApplication = false
useLegacyStacker = false
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

  [deploy.multiRegionConfig.europe-west4-drams3a]
  numReplicas = 1

[env]
NODE_ENV = "production"
PORT = "4000"
