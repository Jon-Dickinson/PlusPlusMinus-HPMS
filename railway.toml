# Railway configuration for monorepo backend app
# Located at /backend
# Updated for CORS fix deployment

[build]
builder = "NIXPACKS"
buildCommand = "cd backend && npm ci && npm run build"
buildDirectory = "backend"

[start]
cmd = "cd backend && npm run start"

# Runs before starting the app (for Prisma migrations)
deployCommand = "cd backend && npx prisma migrate deploy && npx prisma generate"

[deploy]
runtime = "V2"
numReplicas = 1
sleepApplication = false
useLegacyStacker = false
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

  [deploy.multiRegionConfig.europe-west4-drams3a]
  numReplicas = 1

[env]
NODE_ENV = "production"
PORT = "4000"
JWT_SECRET = "X31hS0hWclh5Y25VUWptQjJxd3pwNlV4Z1QzZlgyc1c3c2hYc0tMdFdQcG5oR0Q3R3d5M0E0Yg=="
DATABASE_URL = "postgresql://neondb_owner:npg_tBWDYklvF93i@ep-floral-base-abz6128n-pooler.eu-west-2.aws.neon.tech/neondb?sslmode=require"
NEXT_PUBLIC_STACK_PROJECT_ID = "35d6e253-aece-470e-b442-836df94e9d08"
NEXT_PUBLIC_STACK_PUBLISHABLE_CLIENT_KEY = "pck_k96endr1pzmbadqddbmr4vr167msykvsp1wk7hbc6p3sr"
STACK_SECRET_SERVER_KEY = "ssk_0svmame5c9e4dtda8t7s98s2eb5czs14ybrs5f55m7bag"
