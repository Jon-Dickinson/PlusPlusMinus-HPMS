// schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ────────────────────────────────
// ENUMS
// ────────────────────────────────

enum UserRole {
  ADMIN
  MAYOR
  VIEWER
}

// ────────────────────────────────
// MODELS
// ────────────────────────────────

model User {
  id          Int       @id @default(autoincrement())
  firstName   String
  lastName    String
  email       String    @unique
  password    String
  role        UserRole  @default(VIEWER)
  nationality String?
  homeCity    String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  cities      City[]
}

model City {
  id            Int        @id @default(autoincrement())
  name          String
  country       String?
  mayorId       Int
  population    Int         @default(0)
  powerUsage    Int         @default(0)
  waterUsage    Int         @default(0)
  resourceLimit Int         @default(1000)
  isActive      Boolean     @default(true)
  createdAt     DateTime    @default(now())

  mayor         User        @relation(fields: [mayorId], references: [id])
  buildLogs     BuildLog[]
  notes         Note[]
  buildings     Building[]
}

model BuildLog {
  id        Int      @id @default(autoincrement())
  cityId    Int
  action    String
  value     Int?
  createdAt DateTime @default(now())

  city      City     @relation(fields: [cityId], references: [id])
}

model Note {
  id        Int      @id @default(autoincrement())
  cityId    Int
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  city      City     @relation(fields: [cityId], references: [id])
}

model BuildingCategory {
  id          Int       @id @default(autoincrement())
  name        String    @unique
  description String?
  createdAt   DateTime  @default(now())

  buildings   Building[]
}

model Building {
  id             Int                 @id @default(autoincrement())
  cityId         Int?                
  name           String
  categoryId     Int?
  level          Int                 @default(1)
  sizeX          Int                 @default(1)
  sizeY          Int                 @default(1)
  powerUsage     Int                 @default(0)
  powerOutput    Int                 @default(0)
  waterUsage     Int                 @default(0)
  waterOutput    Int                 @default(0)
  createdAt      DateTime            @default(now())

  city           City?               @relation(fields: [cityId], references: [id])
  category       BuildingCategory?   @relation(fields: [categoryId], references: [id])
  resources      BuildingResource[]
}

model BuildingResource {
  id         Int      @id @default(autoincrement())
  buildingId Int
  type       String
  amount     Int      @default(0)
  createdAt  DateTime @default(now())

  building   Building @relation(fields: [buildingId], references: [id])
}
